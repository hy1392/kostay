<?php
	session_start();
?>
	<!DOCTYPE html>
	<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<title>Kostay</title>
		<meta name="keywords" content="Download, Apartment, Premium, Real Estate, HMTL, Site Template, property, mortgage, CSS" />
		<meta name="description" content="Download Apartment - Premium Real Estate HMTL Site Template" />
		<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
		<link rel="icon" href="favicon.ico" type="image/x-icon">

		<!-- Bootstrap -->
		<link rel="stylesheet" href="bootstrap/bootstrap.min.css">
		<!-- Font awesome styles -->
		<link rel="stylesheet" href="apartment-font/css/font-awesome.min.css">
		<!-- Custom styles -->
		<link rel='stylesheet' type='text/css' href='http://fonts.googleapis.com/css?family=Roboto:400,400italic,300,300italic,500,500italic,700,700italic&amp;subset=latin,latin-ext'>
		<link rel="stylesheet" type="text/css" href="css/plugins.css">
		<link rel="stylesheet" type="text/css" href="css/apartment-layout.css">
		<link id="skin" rel="stylesheet" type="text/css" href="css/apartment-colors-blue.css">


		<!--[if lt IE 9]
  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

	</head>

	<body>
		<div class="loader-bg"></div>
		<div id="wrapper">

			<!-- Page header -->
			<header>
				<div class="top-bar-wrapper">
					<div class="container top-bar">
						<div class="row">
							<div class="col-xs-5 col-sm-8">
								<div class="top-mail pull-left hidden-xs">
									<span class="top-icon-circle">
								<i class="fa fa-envelope fa-sm"></i>
							</span>
									<span class="top-bar-text">admin@koreatech.ac.kr</span>
								</div>
								<div class="top-phone pull-left hidden-xxs">
									<span class="top-icon-circle">
								<i class="fa fa-phone"></i>
							</span>
									<span class="top-bar-text">(0)-123-456-789</span>
								</div>
								<div class="top-localization pull-left hidden-sm hidden-md hidden-xs">
									<span class="top-icon-circle pull-left">
								<i class="fa fa-map-marker"></i>
							</span>
									<span class="top-bar-text">KOREA</span>
								</div>
							</div>
							<div class="col-xs-7 col-sm-4">
								<div class="top-social-last top-dark pull-right" data-toggle="tooltip" data-placement="bottom" title="Login/Register">
									<a class="top-icon-circle" href="#login-modal" data-toggle="modal">
										<i class="fa fa-lock"></i>
									</a>
								</div>

								<div class="top-social pull-right">
									<a class="top-icon-circle" href="#">
										<i class="fa fa-facebook"></i>
									</a>
								</div>
								<div class="top-social pull-right">
									<a class="top-icon-circle" href="#">
										<i class="fa fa-twitter"></i>
									</a>
								</div>
								<div class="top-social pull-right">
									<a class="top-icon-circle" href="#">
										<i class="fa fa-google-plus"></i>
									</a>
								</div>
								<div class="top-social pull-right">
									<a class="top-icon-circle" href="#">
										<i class="fa fa-skype"></i>
									</a>
								</div>
							</div>
						</div>
					</div>
					<!-- /.top-bar -->
				</div>
				<!-- /.Page top-bar-wrapper -->

				<?include("config/mypage_navbar.html");?>
			</header>

			<!--
    <section class="short-image no-padding blog-short-title">
		<div class="container">
			<div class="row">
				<div class="col-xs-12 col-lg-12 short-image-title">
					<h5 class="subtitle-margin second-color">dashboard</h5>
					<h1 class="second-color">my account</h1>
					<div class="short-title-separator"></div>
				</div>
			</div>
		</div>
    </section>
  -->

			<section class="section-light section-top-shadow">
				<div class="container">
					<div class="row">
						<div class="col-xs-12 col-md-9 col-md-push-3">
							<div class="row">
								<div class="col-xs-12">
									<h5 class="subtitle-margin">edit</h5>
									<h1>사용자 관리<span class="special-color">.</span></h1>
									<div class="title-separator-primary"></div>
								</div>
							</div>

							<form name="agent-from" action="#" enctype="multipart/form-data">
								<div class="row margin-top-60">
									<div class="col-xs-12">
										<div class="labelled-textarea">
											<label for="description">사용안내</label>
											<textarea id="description" name="description" class="input-full main-input">  본 페이지는 Kostay를 사용하는 사용자 관리를 위한 페이지 입니다. 현재 Kostay에 가입을 신청한 사용자 목록을 볼 수 있으며, 각 사용자 별 권한을 부여할 수 있습니다. 권한으로는 Kostay 시스템 전반적인 기능을 총괄하는 관리자, 운영 중인 쉐어하우스를 등록하고 입주자를 관리할 수 있는 운영자, 쉐어하우스 입주 신청을 할 수 있는 입주자로 나누어 집니다. 모든 권한에서는 공통적으로 로그인, 회원가입, 검색 기능을 이용할 수 있으며, 각 권한 별 사용할 수 있는 기능이 나뉩니다.</textarea>
										</div>
									</div>
								</div>

								<div class="row margin-top-30">
									<div class="col-xs-12">
										<div class="info-box">
											<p>가입을 신청한 사용자 목록을 볼 수 있으며, 각 사용자에게 권한을 부여할 수 있습니다.</p>
											<div class="small-triangle"></div>
											<div class="small-icon"><i class="fa fa-info fa-lg"></i></div>
										</div>
									</div>
								</div>

								<div class="row margin-top-60">
									<div class="table-responsive">
										<table class="table table-hover">
											<thead class="text-center">
												<tr>
													<td>순번</td>
													<td>사용자이름</td>
													<td>사용자이메일(ID)</td>
													<td>현재상태</td>
													<td>권한변경</td>
												</tr>
											</thead>

											<?php
                  include 'server/dbconnect.php';

									$selectIndexTmp = 1;
									$selectIndex = null;
								  $query = "select * from users";
                  $result = mysqli_query($conn, $query);
                  $index = 0;

                  while($row = mysqli_fetch_assoc($result)){
                ?>

												<tbody class="text-center">
													<tr>
														<td style="padding:20px 10px;">
															<? echo $index + 1 ?>
														</td>
														<td style="padding:20px 10px;">
															<? echo $row['username'] ?>
														</td>
														<td id="email" style="padding:20px 10px;">
															<? echo $row['email'] ?>
														</td>
														<td style="padding:20px 10px;">
															<?
												$flag = $row['flag'];

												if($flag == 0) echo "가입승인대기";
												else if($flag == 1) echo "관리자";
												else if($flag == 2) echo "운영자";
												else if($flag == 3) echo "입주자";
											?>
														</td>

														<td>
															<?
												$id = array();

												if($flag != 1){
												  $selectIndex = "flag_select".$selectIndexTmp;
											?>
																<select id="<? echo $selectIndex ?>" onchange="chFlag(this)" name="flag" class="bootstrap-select" title="권한">
												<option value="운영자">운영자</option>
												<option value="입주자">입주자</option>
											</select>
																<?
													$id[$selectIndexTmp] = $row['email'];
													$selectIndexTmp++;
												}
											?>
														</td>
													</tr>
												</tbody>

												<script>
													var chflag = new Array();
													var value;
													var param = new Array();
													var jsonparam;

													function chFlag(x) {
														var data = new Object();
														var flag = document.getElementById(x.id);
														//console.log(flag);
														var selectIndex = x.id.split("flag_select");
														//console.log(selectIndex[1]);

														value = flag.options[flag.selectedIndex].value;
														//console.log(<? echo $selectIndex ?>);
														//alert(x.id);

														if (value == "운영자") chflag[selectIndex] = 2;
														else if (value == "입주자") chflag[selectIndex] = 3;
														//console.log(selectIndex[1] +"////" +chflag[selectIndex]);

														data.index = selectIndex[1];
														data.flag = chflag[selectIndex];

														param.push(data);
														jsonparam = JSON.stringify(param);
														//alert(jsonparam);
													}


													function flagsave() {

														$(document).ready(function() {
															jQuery.ajax({
																type: "POST",
																url: "server/changeFlag.php",
																contentType: 'application/json; charset=UTF-8',
																data: jsonparam,
																success: function() {
																	alert("권한 저장 완료");
																	history.go(0);
																},
																error: function(xhr, status, error) {
																	alert(error);
																}
															});
														});
														//location.href= "server/changeFlag.php?param=" + jsonparam;
														return true;
													}
												</script>

												<?php
                    $index++;
                  }
                ?>
										</table>
									</div>
								</div>

								<div class="row margin-top-15">
									<div class="col-xs-12">
										<div class="center-button-cont center-button-cont-border">
											<a href="#" onclick="javascript:flagsave();" class="button-primary button-shadow">
												<span>save</span>
												<div class="button-triangle"></div>
												<div class="button-triangle2"></div>
												<div class="button-icon"><i class="fa fa-lg fa-floppy-o"></i></div>
											</a>
										</div>
									</div>
								</div>
							</form>

							<div class="row margin-top-60"></div>
						</div>

						<div class="col-xs-12 col-md-3 col-md-pull-9">
							<div class="sidebar-left">
								<h3 class="sidebar-title">KoStay 관리<span class="special-color">.</span></h3>
								<div class="title-separator-primary"></div>
								<br><br>
								<div class="center-button-cont margin-top-15">
									<a href="submit-property.html" class="button-alternative button-shadow button-full">
										<span>가입 승인 및 권한 설정</span>
										<div class="button-triangle"></div>
										<div class="button-triangle2"></div>
										<div class="button-icon"><i class="jfont fa-lg">&#xe804;</i></div>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>

			<footer class="large-cont">
				<div class="container">
					<div class="row">
						<div class="col-xs-6 col-sm-6 col-lg-3">
							<h4 class="second-color">contact us<span class="special-color">.</span></h4>
							<div class="footer-title-separator"></div>
							<p class="footer-p">KoStay는 국내뿐만 아니라 국외 한인 동포 사회를 위한 쉐어하우스 서비스를 제공합니다.</p>
							<address>
						<span><i class="fa fa-map-marker"></i>KOREA</span>
						<div class="footer-separator"></div>
						<span><i class="fa fa-envelope fa-sm"></i><a href="#">admin@admin.ac.kr</a></span>
						<div class="footer-separator"></div>
						<span><i class="fa fa-phone"></i>01-23456789</span>
					</address>
							<div class="clear"></div>
						</div>
						<div class="col-xs-6 col-sm-6 col-lg-3">
							<h4 class="second-color">quick links<span class="special-color">.</span></h4>
							<div class="footer-title-separator"></div>
							<ul class="footer-ul">
								<li><span class="custom-ul-bullet"></span><a href="index.html">Home</a></li>
								<li><span class="custom-ul-bullet"></span><a href="listing-grid-right-sidebar.html">Listing</a></li>
								<li><span class="custom-ul-bullet"></span><a href="agencies-listing-right-sidebar.html">Agencies</a></li>
								<li><span class="custom-ul-bullet"></span><a href="archive-grid.html">Blog</a></li>
								<li><span class="custom-ul-bullet"></span><a href="contact1.html">Contact us</a></li>
								<li><span class="custom-ul-bullet"></span><a href="submit-property.html">Submit property</a></li>
							</ul>
						</div>
						<div class="col-xs-12 col-sm-6 col-lg-3">
							<h4 class="second-color">KoSay뉴스<span class="special-color">.</span></h4>
							<div class="footer-title-separator"></div>
							<div class="row">
								<div class="col-xs-6 col-sm-12">
									<article>
										<!--<a href="blog-right-sidebar.html"><img src="images/prepared.png" alt="" class="footer-blog-image" /></a>-->
										<div class="footer-blog-title"><a href="blog-right-sidebar.html">2016년도 올해 최고의 서비스. KoStay 선정</a></div>
										<div class="footer-blog-date"><i class="fa fa-calendar-o"></i>28/11/16</div>
										<div class="clearfix"></div>
									</article>
									<div class="footer-blog-separator hidden-xs"></div>
								</div>
								<div class="col-xs-6 col-sm-12">
									<article>
										<!--<a href="blog-right-sidebar.html"><img src="images/prepared.png" alt="" class="footer-blog-image" /></a>-->
										<div class="footer-blog-title"><a href="blog-right-sidebar.html">KoStay 한인 사회 진출!</a></div>
										<div class="footer-blog-date"><i class="fa fa-calendar-o"></i>15/10/16</div>
										<div class="clearfix"></div>
									</article>
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-lg-3">
							<h4 class="second-color">좋은일소식<span class="special-color">.</span></h4>
							<div class="footer-title-separator"></div>
							<p class="footer-p">컨텐츠 준비중입니다.</p>
							<!--
					<form class="form-inline footer-newsletter">
						<input type="email" class="form-control" id="exampleInputEmail2" placeholder="enter your email">
						<button type="submit" class="btn"><i class="fa fa-lg fa-paper-plane"></i></button>
					</form>
					-->
						</div>
					</div>
				</div>
			</footer>
			<footer class="small-cont">
				<div class="container">
					<div class="row">
						<div class="col-xs-12 col-md-6 small-cont">
							<img src="images/logo/kostay-f2.png" alt="" class="img-responsive footer-logo" />
						</div>
						<div class="col-xs-12 col-md-6 footer-copyrights">
							&copy; Copyright 2016 <a href="#" target="blank">좋은일컴퍼니 & KOREATECH</a>.
						</div>
					</div>
				</div>
			</footer>
		</div>

		<!-- Move to top button -->

		<div class="move-top">
			<div class="big-triangle-second-color"></div>
			<div class="big-icon-second-color"><i class="jfont fa-lg">&#xe803;</i></div>
		</div>

		<!-- Login modal -->
		<div class="modal fade apartment-modal" id="login-modal">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-body">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<div class="modal-title">
							<h1>Login<span class="special-color">.</span></h1>
							<div class="short-title-separator"></div>
						</div>
						<input name="login" type="email" class="input-full main-input" placeholder="Email" />
						<input name="password" type="password" class="input-full main-input" placeholder="Your Password" />
						<a href="my-profile.html" class="button-primary button-shadow button-full">
							<span>Sing In</span>
							<div class="button-triangle"></div>
							<div class="button-triangle2"></div>
							<div class="button-icon"><i class="fa fa-user"></i></div>
						</a>
						<a href="#" class="forgot-link pull-right">Forgot your password?</a>
						<div class="clearfix"></div>
						<p class="login-or">OR</p>
						<a href="#" class="facebook-button">
							<i class="fa fa-facebook"></i>
							<span>Login with Facebook</span>
						</a>
						<a href="#" class="google-button margin-top-15">
							<i class="fa fa-google-plus"></i>
							<span>Login with Google</span>
						</a>
						<p class="modal-bottom">Don't have an account? <a href="#" class="register-link">REGISTER</a></p>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal-dialog -->
		</div>
		<!-- /.modal -->

		<!-- Register modal -->
		<div class="modal fade apartment-modal" id="register-modal">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-body">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<div class="modal-title">
							<h1>Register<span class="special-color">.</span></h1>
							<div class="short-title-separator"></div>
						</div>
						<input name="first-name" type="text" class="input-full main-input" placeholder="Frist name" />
						<input name="last-name" type="text" class="input-full main-input" placeholder="Last name" />
						<input name="email" type="email" class="input-full main-input" placeholder="Email" />
						<input name="password" type="password" class="input-full main-input" placeholder="Password" />
						<input name="repeat-password" type="password" class="input-full main-input" placeholder="Repeat Password" />
						<a href="my-profile.html" class="button-primary button-shadow button-full">
							<span>Sing up</span>
							<div class="button-triangle"></div>
							<div class="button-triangle2"></div>
							<div class="button-icon"><i class="fa fa-user"></i></div>
						</a>
						<div class="clearfix"></div>
						<p class="login-or">OR</p>
						<a href="#" class="facebook-button">
							<i class="fa fa-facebook"></i>
							<span>Sing Up with Facebook</span>
						</a>
						<a href="#" class="google-button margin-top-15">
							<i class="fa fa-google-plus"></i>
							<span>Sing Up with Google</span>
						</a>
						<p class="modal-bottom">Already registered? <a href="#" class="login-link">SING IN</a></p>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal-dialog -->
		</div>
		<!-- /.modal -->

		<!-- Forgotten password modal -->
		<div class="modal fade apartment-modal" id="forgot-modal">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-body">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<div class="modal-title">
							<h1>Forgot your password<span class="special-color">?</span></h1>
							<div class="short-title-separator"></div>
						</div>
						<p class="negative-margin forgot-info">Instert your account email address.<br/>We will send you a link to reset your password.</p>
						<input name="login" type="email" class="input-full main-input" placeholder="Your email" />
						<a href="my-profile.html" class="button-primary button-shadow button-full">
							<span>Reset password</span>
							<div class="button-triangle"></div>
							<div class="button-triangle2"></div>
							<div class="button-icon"><i class="fa fa-user"></i></div>
						</a>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal-dialog -->
		</div>
		<!-- /.modal -->

		<!-- jQuery  -->
		<script type="text/javascript" src="js/jQuery/jquery.min.js"></script>
		<script type="text/javascript" src="js/jQuery/jquery-ui.min.js"></script>

		<!-- Bootstrap-->
		<script type="text/javascript" src="bootstrap/bootstrap.min.js"></script>

		<!-- Google Maps -->
		<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDfDCV5hXiPamCIT8_vwGXuzimLQ9MF76g&amp;sensor=false&amp;libraries=places"></script>

		<!-- plugins script -->
		<script type="text/javascript" src="js/plugins.js"></script>

		<!-- template scripts -->
		<script type="text/javascript" src="mail/validate.js"></script>
		<script type="text/javascript" src="js/apartment.js"></script>

	</body>

	</html>

<?php
	session_start();
	if(!isset($_SESSION['flag'])) echo "<script>location.href='index.html'</script>";
	include 'server/dbconnect.php';
?>
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Kostay</title>
  <meta name="keywords" content="Download, Apartment, Premium, Real Estate, HMTL, Site Template, property, mortgage, CSS" />
  <meta name="description" content="Download Apartment - Premium Real Estate HMTL Site Template" />
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
  <link rel="icon" href="favicon.ico" type="image/x-icon">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="bootstrap/bootstrap.min.css">
  <!-- Font awesome styles -->
  <link rel="stylesheet" href="apartment-font/css/font-awesome.min.css">
  <!-- Custom styles -->
  <link rel='stylesheet' type='text/css' href='http://fonts.googleapis.com/css?family=Roboto:400,400italic,300,300italic,500,500italic,700,700italic&amp;subset=latin,latin-ext'>
  <link rel="stylesheet" type="text/css" href="css/plugins.css">
  <link rel="stylesheet" type="text/css" href="css/apartment-layout.css">
  <link rel="stylesheet" type="text/css" href="css/search_detail.css">
  <link id="skin" rel="stylesheet" type="text/css" href="css/apartment-colors-blue.css">
  <script src="https://code.jquery.com/jquery-2.2.4.js" integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI=" crossorigin="anonymous"></script>

  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style media="screen">
      .no-margin{
        margin: 0px !important;
      }
      .no-padding{
        padding: 0px !important;
      }
      .margin-15{
        margin: : 15px;
      }
      @media (max-width:480px) {
        .margin-bottom-30-10{
          margin-bottom: 10px;
        }
        .xs-100{
          width: 100%;
        }
      }
      @media (min-width:481px) {
        .margin-bottom-30-10{
          margin-bottom: 30px;
        }
      }
        label{
                position: relative;
                top: 12px;
                left: 20px;
            font-size: 16px;
        }
        .register{
            height: 35px;
            text-align: center;
            vertical-align: middle;
            font-size: 16px;
            padding: 7px;
            border: 1px solid #eee;
            cursor: pointer;
        }
        .temp-a{
            display: block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>
</head>

<body>
  <div class="loader-bg"></div>
  <div id="wrapper">

    

		<?
			$query="select * from user_movein_list where email='".$_SESSION['id']."' order by time DESC";
			$result = mysqli_query($conn,$query);
			$row = mysqli_fetch_array($result);
		?>
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="margin-top-60 apartment-tabs">
            <div class="tab-header">
              <h3 class="title-negative-margin" style="display:inline">입주신청</h3>
            </div>

            <div class="title-separator-primary"></div>
            <!-- Nav tabs -->


            <!-- Tab panes -->
            <div class="tab-content">
              <div role="tabpanel" class="tab-pane active" id="t1">

								<div style="display:none" id="house" name="<?=$_GET['house']?>"></div>
								<div style="display:none" id="bed" name="<?=$_GET['bed']?>"></div>

                <div class="row">
											<!--성별-->
                  <div class="col-xs-12 col-sm-6 margin-bottom-30-10">

                    <select id="gender" name="country1" class="no-margin bootstrap-select" title="성별:">
    									<option value="여자" <?if($row['gender']=="여자") echo "selected='selected'"?>>여자</option>
    									<option value="남자" <?if($row['gender']=="남자") echo "selected='selected'"?>>남자</option>
								    </select>
                  </div>

									<!--국적-->
                  <div class="col-xs-12 col-sm-6 margin-bottom-30-10">

                    <select id="nationality" name="country1" class="no-margin bootstrap-select" title="국적:">
    									<option value="한국" <?if($row['nationality']=="한국") echo "selected='selected'"?>>한국</option>
    									<option value="중국" <?if($row['nationality']=="중국") echo "selected='selected'"?>>중국</option>
                      <option value="일본" <?if($row['nationality']=="일본") echo "selected='selected'"?>>일본</option>
                      <option value="호주" <?if($row['nationality']=="호주") echo "selected='selected'"?>>호주</option>
                      <option value="영국" <?if($row['nationality']=="영국") echo "selected='selected'"?>>영국</option>
                      <option value="미국" <?if($row['nationality']=="미국") echo "selected='selected'"?>>미국</option>
                      <option value="캐나다" <?if($row['nationality']=="캐나다") echo "selected='selected'"?>>캐나다</option>
								    </select>
                  </div>

									<!--나이-->
                  <div class="col-xs-12 col-sm-6 margin-bottom-30-10" style="display:none">
                    <input name="name" id="age" type="text" class="no-margin bootstrap-select input-short2 main-input required,all" placeholder="나이:" value="123">123
                  </div>

                  <div class="col-xs-12"></div>

									<!--전화번호-->
                 <div class="col-xs-3 margin-bottom-30-10" style="padding-right:0px">
                    <select id="country" name="country1" class="no-margin bootstrap-select" title="국가코드">
                       <?
                        $tmp = explode(" ",$row['hp']);
                       ?>
                        <option value="+82" <? if($tmp[0]=="+82") echo "selected='selected'";?> >한국(+82)</option>
                        <option value="+61" <? if($tmp[0]=="+61") echo "selected='selected'";?>>호주(+61)</option>
                    </select>
                  </div>
                  <div class="col-xs-9 margin-bottom-30-10">

                    <input name="name" id="hp" type="text" class="no-margin bootstrap-select input-short2 main-input required,all" placeholder="전화번호:" value="<?if($row['hp']!="") echo $tmp[1];?>">
                  </div>
        
        
									<!--이메일-->
                  <div class="col-xs-12 col-sm-5 margin-bottom-30-10">
                    <input name="name" type="text" id="contact_email" class="no-margin bootstrap-select input-short2 main-input required,all" placeholder="이메일:" value="<?=$_SESSION['id']?>">
                  </div>

									<!--연락처 공개여부-->
<!--
                  <div class="col-xs-2 margin-bottom-30-10">
                    <h4 class="title-negative-margin" style="display:inline;">연락처 공개</h4>
                    <div class="title-separator-primary"></div>
                    <select id="notify" name="country1" class="no-margin bootstrap-select" title="연락처 공개:">
                      <option value="공개" <?if($row['notify']=="공개") echo "selected='selected'"?>>공개</option>
                      <option value="비공개" <?if($row['notify']=="비공개") echo "selected='selected'"?>>비공개</option>
                    </select>
                  </div>
-->

                
                				<!--입주희망일-->
                   <div class="col-xs-3" style="padding-right:0px">
                     <label for="movein_date">입주희망일</label>
                 </div>
                  <div class="col-xs-9 margin-bottom-30-10">
                    <input name="name" id="movein_date" type="date" class="no-margin bootstrap-select input-short2 main-input required,all" placeholder="입주희망일:" value="<?=$row['movein_date']?>">
                  </div>
				

									<!--생략여부-->
                 <div class="col-xs-8" style="padding-right:0px">
                     <label for="movein_date">일단 집에 방문하시겠습니까?</label>
                 </div>
                  <div class="col-xs-4 margin-bottom-30-10">
                  <script>
                      function checkBox2(param, s){
                        $('.register_selected').removeClass('register_selected');
                        $(param).addClass('register_selected');
                        $("#skip_visit").attr("value",s);
                      }
                    </script>
                   <div id="skip_visit" value="<?if($row['skip_visit']=='예') echo '예'; else echo '아니오';?>">
                      <div class="col-xs-6 register <?if($row['skip_visit']=='예') echo 'register_selected';?>" onclick="checkBox2(this,'예');">예</div>
                      <div class="col-xs-6 register <?if($row['skip_visit']=='아니오') echo 'register_selected';?>" onclick="checkBox2(this, '아니오');">아니오</div>
                   </div>
                  </div>
                  <script>
                      $(document).ready(function(){
                          if($("#skip_visit").attr("value")=="아니오"){
                          $("#hope").hide();
                          }
                          $(".register").on("click",function(){
                          if($("#skip_visit").attr("value")=="아니오"){
                              $("#hope").hide();
                          }
                          else $("#hope").show();
                      });
                      });
                      
                  </script>
                  
                 <div id="hope">
                    <!--방문 희망일-->
                    <div class="col-xs-3" style="padding-right:0px">
                         <label for="visit_date">방문희망일</label>
                     </div>
                      <div class="col-xs-9 margin-bottom-30-10">
                                            <?
                                                $visit_date=substr($row['visit_date'], 0, 10);
                                                $visit_time=substr($row['visit_date'], 11,5);
                                            ?>
                        <input name="name" id="visit_date" type="date" class="no-margin bootstrap-select input-short2 main-input required,all" placeholder="방문희망일:" value="<?=$visit_date?>">
                      </div>

                                        <!--방문 희망 시간-->
                     <div class="col-xs-3" style="padding-right:0px">
                         <label for="visit_time">방문시간대</label>
                     </div>
                      <div class="col-xs-9 margin-bottom-30-10">
                        <input name="name" id="visit_time" type="time" class="no-margin bootstrap-select input-short2 main-input required,all" placeholder="방문시간대:" value="<?=$visit_time?>">
                      </div>
                 </div>
                

					

									<!--인사말-->
                  <div class="col-xs-12 margin-bottom-30-10">
                    <textarea name="name" id="description" type="text" rows="3" class="no-margin bootstrap-select input-short2 main-input required,all" placeholder="인사말:"> <?if($row['description']!="") echo $row['description'];?></textarea>
                  </div>

									<!--확인, 다시작성, 취소 버튼-->
                  <div class="col-xs-12 margin-bottom-30-10 centered-text">
                    <a style="cursor:pointer" onclick="save();" class="btn btn-default xs-100">
      								<span>확인</span>
      							</a>
                    <!-- <a style="cursor:pointer" onclick="window.location.reload(true);" class="btn btn-default xs-100"> -->
										<a style="cursor:pointer" onclick="reset();" class="btn btn-default xs-100">
      								<span>다시작성</span>
      							</a>
                    <a style="cursor:pointer" onclick="window.close();" class="btn btn-default xs-100">
      								<span>취소</span>
      							</a>
                  </div>


                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
		<?
			$house_id = $_GET['house'];
			$bed_id = $_GET['bed'];
		?>
		
		<!-- request modal -->
        <div class="modal fade apartment-modal" id="request-modal" style="top:10%;" data-keyboard="false" data-backdrop="static">
            <div class="modal-dialog" style="width :300px; height:450px;">
                <div class="modal-content" style="width :300px; height:450px;">
                    <div class="modal-body" style="width :300px; height:450px; padding:0px; border:4px solid black">
                        <div style="height:40px;background-color:black"><img src="images/logo/bottom_logo_webpage.png" alt="" style="height:23px; margin:8px; width:auto;"></div>
                        <div style="margin-top: 50px;">
                            <p style="font-size:25px;text-align:center;color:black">입주신청 성공</p>
                            <p style="font-size:55px;text-align:center;color:black;font-weight:bold;margin-top: 35px;">신청번호</p>
                            <p class="wait-num" style="font-size:55px;text-align:center;color:black;font-weight:bold;margin-top: 55px;"></p>
                            <p style="font-size:20px;text-align:center;color:black;margin-top: 40px; padding: 0px 30px;">감사합니다.<br/>곧 연락드리겠습니다.<br/> </p>
                            <input type="button" style="font-size:25px;width:200px;  color:white; background:rgb(55, 151, 221); height:40px; margin:10px 47px; border:none; " value="확인" onclick="window.close();">
                        </div>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        <!-- /.modal -->
        
        <!-- fail modal -->
        <div class="modal fade apartment-modal" id="fail-modal" style="top:10%;" data-keyboard="false">
            <div class="modal-dialog" style="width :300px; height:450px;">
                <div class="modal-content" style="width :300px; height:450px;">
                    <div class="modal-body" style="width :300px; height:450px; padding:0px; border:4px solid black">
                        <div style="height:40px;background-color:black"><img src="images/logo/bottom_logo_webpage.png" alt="" style="height:23px; margin:8px; width:auto;"></div>
                        <div style="margin-top: 20px;text-align: center;">
                            <img src="images/naro_b_basic.png" alt="" style="height:150px; width:auto;">
                            <p style="font-size:55px;text-align:center;color:black;font-weight:bold;margin-top: 35px;">저장실패</p>
                            <p style="font-size:20px;text-align:center;color:black;margin-top: 40px; padding: 0px 30px;">입력하지 않은 값이 있습니다.</p>
                            <input type="button" style="font-size:25px;width:200px;  color:white; background:rgb(55, 151, 221); height:40px; margin:10px 47px; border:none; " value="확인" onclick="$('#fail-modal').modal('toggle');">
                        </div>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        <!-- /.modal -->
        
        <!-- fail modal -->
        <div class="modal fade apartment-modal" id="fill-modal" style="top:10%;" data-keyboard="false">
            <div class="modal-dialog" style="width :300px; height:450px;">
                <div class="modal-content" style="width :300px; height:450px;">
                    <div class="modal-body" style="width :300px; height:450px; padding:0px; border:4px solid black">
                        <div style="height:40px;background-color:black"><img src="images/logo/bottom_logo_webpage.png" alt="" style="height:23px; margin:8px; width:auto;"></div>
                        <div style="margin-top: 20px;text-align: center;">
                            <img src="images/naro_b_basic.png" alt="" style="height:150px; width:auto;">
                            <p style="font-size:55px;text-align:center;color:black;font-weight:bold;margin-top: 35px;">요청실패</p>
                            <p style="font-size:20px;text-align:center;color:black;margin-top: 40px; padding: 0px 30px;">이미 대기신청을 완료한 하우스 입니다.</p>
                            <input type="button" style="font-size:25px;width:200px;  color:white; background:rgb(55, 151, 221); height:40px; margin:10px 47px; border:none; " value="확인" onclick="$('#fill-modal').modal('toggle');">
                        </div>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        <!-- /.modal -->
		
		<script>
		function save(){
			if($("#gender").val()==""||$("#nationality").val()==""||$("#age").val()==""||$("#hp").val()==""||$("#contact_email").val()==""||$("#skip_visit").attr("value")==""||$("#description").val()=="" ||$("#movein_date").val()==""){
               $("#fail-modal").modal("show");
            }
			else{
				$.ajax({
					url:"server/wait_list.php",
					type:"POST",
					data:{
						condition : "신청",
						gender : $("#gender").val(),
						nationality : $("#nationality").val(),
						age : $("#age").val(),
						hp : $("#country").val()+" "+$("#hp").val(),
						contact_email : $("#contact_email").val(),
						notify : "1",
						visit_date : $("#visit_date").val(),
						visit_time : $("#visit_time").val(),
						skip_visit : $("#skip_visit").attr("value"),
						movein_date : $("#movein_date").val(),
						description : $("#description").val(),
						house_id :  $("#house").attr("name"),
						bed_id : $("#bed").attr("name")
					},
					success: function(data){
						if(data!="이미 입주신청을 완료한 하우스 입니다."){
							$(".wait-num").text(data);
							$("#request-modal").modal("show");
						 }
						else $("#fill-modal").modal("show");

					},
					error: function(){
						swal("에러 발생!","잠시후 다시 시도해 주세요.","error");
					}
				});
			}
		}

		function reset(){
			$("input").val('');
			$("textarea").val('');
			$("#contact_email").val("<?=$_SESSION['id']?>");
		}
		</script>

		<!--small footer-->
		<?include("config/footer.html")?>

  </div>

  <!-- Move to top button -->

  <div class="move-top">
    <div class="big-triangle-second-color"></div>
    <div class="big-icon-second-color"><i class="jfont fa-lg">&#xe803;</i></div>
  </div>
  <!-- Move to top button -->

	<!--로그인, 회원가입, 비밀번호 찾기-->
	<?include("config/user.html")?>
	<!--sweetalert2-->
	<link rel="stylesheet" type="text/css" href="css/sweetalert.css">
	<script src="js/sweetalert.min.js"></script>

  <!-- jQuery  -->
  <script type="text/javascript" src="js/jQuery/jquery.min.js"></script>
  <script type="text/javascript" src="js/jQuery/jquery-ui.min.js"></script>

  <!-- Bootstrap-->
  <script type="text/javascript" src="bootstrap/bootstrap.min.js"></script>

  <!-- Google Maps -->
  <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCmOeOzyKWTkImd2mysYTVbzJaZYIlsGrI&amp;sensor=false&amp;libraries=places"></script>

  <!-- plugins script -->
  <script type="text/javascript" src="js/plugins.js"></script>

  <!-- template scripts -->
  <script type="text/javascript" src="mail/validate.js"></script>
  <script type="text/javascript" src="js/apartment.js"></script>
	<!--로그인, 회원가입, 비밀번호 찾기-->
	<?include("config/user.html")?>
	<!--sweetalert2-->
	<link rel="stylesheet" type="text/css" href="css/sweetalert.css">
	<script src="js/sweetalert.min.js"></script>

  <!-- google maps initialization -->
  <script type="text/javascript">
    google.maps.event.addDomListener(window, 'load', init);

    function init() {
      var locations = [
        [40.6128, -73.9976, "images/pin-house.png", "estate-details-right-sidebar.html", "images/infobox-offer1.jpg", "Fort Collins, Colorado 80523, USA", "$320 000"],
        [40.7222, -73.7903, "images/pin-commercial.png", "estate-details-right-sidebar.html", "images/infobox-offer2.jpg", "West Fourth Street, New York 10003, USA", "$350 000"],
        [41.0306, -73.7669, "images/pin-house.png", "estate-details-right-sidebar.html", "images/infobox-offer3.jpg", "E. Elwood St. Phoenix, AZ 85034, USA", "$300 000"],
        [41.3006, -72.9440, "images/pin-apartment.png", "estate-details-right-sidebar.html", "images/infobox-offer4.jpg", "Fort Collins, Colorado 80523, USA", "$410 000"],
        [42.2418, -74.3626, "images/pin-land.png", "estate-details-right-sidebar.html", "images/infobox-offer5.jpg", "West Fourth Street, New York 10003, USA", "$295 000"],
        [38.8974, -77.0365, "images/pin-house.png", "estate-details-right-sidebar.html", "images/infobox-offer6.jpg", "E. Elwood St. Phoenix, AZ 85034, USA", "$390 600"],
        [38.7860, -77.0129, "images/pin-apartment.png", "estate-details-right-sidebar.html", "images/infobox-offer7.jpg", "Fort Collins, Colorado 80523, USA", "$299 000"],
        [41.2693, -70.0874, "images/pin-house.png", "estate-details-right-sidebar.html", "images/infobox-offer8.jpg", "Fort Collins, Colorado 80523, USA", "$600 000"],
        [33.7544, -84.3857, "images/pin-commercial.png", "estate-details-right-sidebar.html", "images/infobox-offer9.jpg", "West Fourth Street, New York 10003, USA", "$350 000"],
        [33.7337, -84.4443, "images/pin-house.png", "estate-details-right-sidebar.html", "images/infobox-offer10.jpg", "E. Elwood St. Phoenix, AZ 85034, USA", "$550 000"],
        [33.8588, -84.4858, "images/pin-land.png", "estate-details-right-sidebar.html", "images/infobox-offer1.jpg", "E. Elwood St. Phoenix, AZ 85034, USA", "$670 000"],
        [34.0254, -84.3560, "images/pin-commercial.png", "estate-details-right-sidebar.html", "images/infobox-offer5.jpg", "E. Elwood St. Phoenix, AZ 85034, USA", "$300 000"],
        [39.6282, -86.1320, "images/pin-apartment.png", "estate-details-right-sidebar.html", "images/infobox-offer6.jpg", "E. Elwood St. Phoenix, AZ 85034, USA", "$390 600"],
        [40.5521, -84.5658, "images/pin-apartment.png", "estate-details-right-sidebar.html", "images/infobox-offer2.jpg", "West Fourth Street, New York 10003, USA", "$350 000"],
        [41.6926, -87.6021, "images/pin-house.png", "estate-details-right-sidebar.html", "images/infobox-offer5.jpg", "E. Elwood St. Phoenix, AZ 85034, USA", "$300 000"]
      ];
      offersMapInit("offers-map", locations);

      mapInit(41.2693, -70.0874, "list-map1", "images/pin-house.png", false);
      mapInit(33.7544, -84.3857, "list-map2", "images/pin-apartment.png", false);
      mapInit(33.7337, -84.4443, "list-map3", "images/pin-land.png", false);
      mapInit(33.8588, -84.4858, "list-map4", "images/pin-commercial.png", false);
      mapInit(34.0254, -84.3560, "list-map5", "images/pin-apartment.png", false);
      mapInit(40.6128, -73.9976, "list-map6", "images/pin-house.png", false);
      mapInit(40.6128, -73.7903, "list-map7", "images/pin-house.png", false);
    }
    $(".list-offer-right-large").on("click",function(){
      location.href="view_detail.html";
    });
  </script>

</body>

</html>
